外汇交易和外汇市场

[TOC]



# 一、外汇交易

## 1. 外汇即期交易

## 2. 外汇远期（择期）交易

交易双方约定在未来的某一时点进行的一笔不同币种间的外汇买卖交易。

### 利率平价理论



## 3. 外汇掉期交易

## 4. 货币掉期交易

## 5. 外汇期权交易

### 期权

期权交易是指在未来一定时期可以买卖的权利，是买方向卖方支付一定数量的权利金后拥有的在未来一段时间内或未来某一特定日期以事先商定的价格向卖方购买或出售一定数量标的物的权利，但不负有必须买进或卖出的义务。期权按照行权方式分为**欧式期权**和**美式期权**。 

看涨期权（买入期权）和看跌期权（卖出期权）

## 6. 外汇保证金交易









# 二、外汇市场

## 1. 银行间外汇市场

### 外汇交易平台

### 电子交易平台

1.  全球最大的外汇即期交易平台EBS(ICAP旗下)
2. 彭博电子交易系统 FXGO
3. 汤森路透旗下FXALL
4. 芝加哥商业交易所（CME Group）
5.  [全球主要外汇电子交易平台 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/25365815) 

### 对外资行

常见外资银行及其简称

| 银行名词 | 简称 | 全称                                                         |
| -------- | ---- | ------------------------------------------------------------ |
| 花旗中国 | CITI | _______________________________________________________________________________________________________________________ |
| 汇丰银行 | HSBC |                                                              |
| 摩根银行 |      |                                                              |
| 高盛     | GS   |                                                              |
| 瑞银     |      |                                                              |

中国各大银行名词及简称

| 银行名词     | 简称 | 全称                                    |
| ------------ | ---- | --------------------------------------- |
| 中国建设银行 | CCB  | China Constuction Bank                  |
| 中国农业银行 | ABC  | Agricultural  Bank of China             |
| 中国工商银行 | ICBC | Industrial and Commercial Bank of China |
| 交通银行     | BCM  | Bank of Communications                  |
| 中国银行     | BOC  | Bank Of China                           |
| 招商银行     | CMB  |                                         |
| 兴业银行     | CIB  |                                         |
| 中信银行     | CCB  | China CiTIC Bank                        |
| 广东发展银行 | GDB  |                                         |
| 光大银行     | CEB  |                                         |
| 北京银行     | BOB  | Bank Of Beijing                         |



# 三、贵金属交易

金、银、铂等

### 即期现货市场

1. 伦敦金属交易所
2. 苏黎世黄金市场
3. 上海黄金交易所

### 期货市场

1. 美国纽约金属交易所
2. 东京商品交易所
3. 香港联交所
4. 上海期货交易所

# 四、名词对应

## 常用货币

列举一些常用**货币名称**和缩写对应关系。

| 货币名词         | 货币缩写 | 货币全称               |
| ---------------- | -------- | ---------------------- |
| 人民币           | CNY      | Chinese Yuan           |
| 美元             | USD      | United States Dollar   |
| 英镑             | GBP      | Great Britain Pound    |
| 欧元             | EUR      | Euro                   |
| 加拿大元（加元） | CAD      | CAnadian Dollar        |
| 瑞士法郎         | CHF      | 德文 sCHweizer Franken |
| 日元             | JPY      | JaPanese Yen           |
| 港币             | HKD      | Hong Kong Dollar       |
| 德国马克         | DEM      | 德文 DEutsche M ark    |
| 澳大利亚元       | AUD      | AUstralian Dollar      |
| 法国法郎         | FBF      | FRench Franc           |
| 俄罗斯卢布       | SUR      |                        |
| 新西兰元         | NZD      |                        |
| 泰铢             | THB      |                        |
| 芬兰马克         | FIM      |                        |
| 比利时法郎       | BEF      |                        |
| 韩国元           | KRW      |                        |
| 新加坡元         | SGD      |                        |
| 菲律宾比索       | PHP      |                        |
| 奥地利先令       | ATS      |                        |
| 爱尔兰镑         | IEP      |                        |
| 意大利里拉       | ITL      |                        |
| 卢森堡法郎       | LUF      |                        |
| 荷兰盾           | NLG      |                        |
| 葡萄牙埃斯库多   | PTE      |                        |
| 西班牙比塞塔     | ESP      |                        |
| 印尼盾           | IDR      |                        |
| 马来西亚林吉特   | MYR      |                        |

**特殊标的，贵金属**

| 中文名词 | 缩写 |      |
| -------- | ---- | ---- |
| 黄金     | XAU  |      |
| 白银     | XAG  | #    |

# 五、相关定义

**交易模型**

1. ODM 订单驱动   (Order Driven Model)
2. QDM 报价驱动 （Quote Driven Model）
3. 协商驱动模型 （Negotiate Driven Model）
4. limit



1. FAK  部分成交，不成交部分返回
2. FOK  要么全部成功、要么全部失败



1. 本币市场指债券



1. ER 流水单
2. STP 交易详情单



1. NDF 无本金交割远期

**询价交易方式**

1. ESP 点击成交
2. RFQ 请求报价
3. Neotiate 协商交易
   1. 指有双边授信的的交易双方协商交易要素，一方发起，一方接受则达成的交易方式

**交易模式**

1. 竞价交易（匿名交易）
2. 询价交易
3. 撮合交易

**订单类型**

1. 限价订单
2. 冰山订单
3. OTO订单
4. Standing Stop订单
5. Stop Loss With Payment订单

**设置**

1. 倒挂订单提示
2. 价格偏离提醒
3. 价格过大提醒
4. 大额交易风险提醒
5. OCO成交后剩余订单状态
6. 设置滑点

**存续天数**

1. 



# 六、模块整体业务

1. sds接口服务
2. cds服务
3. mds服务

**业务涉及模块**

| 模块名称         | 涉及业务                                                     |
| ---------------- | ------------------------------------------------------------ |
| Fmut-market      |                                                              |
| Fmut-market-step | CommonCache存储本方报价行情 key格式：实体#业务类型#市场属性#货币对#档位 例如：HO#SPOT#QDM#GBPUSD#SP#1000000 |
|                  | 、quotation/cswap/thread/下四个定时线程 分别是写入hbase、同步redis价格、同步最优深度价格、 |
| Fmut-order       |                                                              |
| Fmut-query       |                                                              |
|                  |                                                              |
| Fmut-web         |                                                              |

**主要功能模块**

1. 行情接入

   |-- 最优行情

   |-- 深度行情

   |-- 成交行情

2. 订单新增

   1. 点击单、
   2. 限价订单、
   3. 冰山订单、
   4. OTO订单
   5. OCO订单
   6. SS订单、
   7. SLWP订单

3. 订单操作

   1. 修改
   2. 撤销
   3. 冻结
   4. 激活
   5. 一键撤销
   6. 一键冻结

4. 算法单实时处理

# 七、特殊名词

1. EBS

>  银行外汇牌价含义

2. CCP

中央对手清算所（CCP）,两大职责：清算和结算

**清算：**

清算过程中，CCP成为买方和买方的交易对手

**结算：**

在结算过程中，CCP监督各方之间证券和/或现金的准确及时转移，以完成交易。

在两个交易对手进行交易后，该交易被转移到CCP。然后，CCP承担交易双方的交易对手风险。

CCP的职责包括风险检查、清算、结算和一般市场监测。



> 按照外汇资金的性质以及买卖方向分为

1. 现汇买入价
2. 现汇卖出价
3. 现钞买入价
4. 现钞卖出价

> 结售汇

结售汇是结汇和售汇的统称。



> 敞口头寸：指未平仓头寸，指由于没有抵补而形成的某种货币买入过多，或卖出过多



> 汤森路透  --  全国最大的情报信息提供商 

世界上最早创办的通讯社之一，也是英国最大的通讯社和西方四大通讯社之一。提供新闻和金融数据。

# 八、C-Swap模块

## 1. 行情接入

### 流程

每个组件中 第一行代表`成交行情`,第二行代表`最优行情`，第三行代表`深度行情`。

### 1. 适配组件

1. 处理`成交行情`，写入事件中
2. `最优行情`和`深度行情`都在一个适配组件中，组装事件往下传递

### 2. 接入组件

1. 无
2. 获取本方缓存报价，判断bid是否为本方报价 是 设置买方报价标识为 `1` 否则为`0`. 
3. 无

### 3. 处理组件

1. 无，将事件写入step上下文中
2. 获取行情集合，判断价格状态，比如：价格延迟、存疑、倒挂、o价、负价等
3. 延迟检查、合法性检查。和最优行情一样。

### 4. 分发组件

1. 更新内存的成交行情，内部分发价格 推送webnet
2. 更新内存最优价、推送mq、推送webNet
3. 更新内存最优价、推送mq、推送webNet

### 5. 存储组件

1. 持久化hbase
2. 持久化hbase
3. 持久化hbase

### 下单流程

下单分为六种方式，分别是`点击单`， `限价订单`,`冰山订单`，`oto订单`，`Standing stop订单`，`Stop Loss With Payment订单`，后两种为算法单。

根据orderType类型不同区分六种订单，根据 transType区分不同交易类型

**订单类型**

| orderType | 名称                                                         |                                                              |
| --------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| FAK       | 点击单                                                       |                                                              |
| LIMIT     | 限价订单                                                     |                                                              |
| ICEBERG   | 冰山订单                                                     |                                                              |
| SS        | 监控订单                                                     | 算法单，在行情接入时比对，如果算法单成立，则直接发送订单，更新数据库 |
| SLWP      | 补偿点订单                                                   | 算法单，在行情接入时比对，如果算法单成立，则直接发送订单，更新数据库 |
| OCO       | oco订单，多个订单成交成功一个后出发事件，继续成交或者剩余全部冻结 |                                                              |
| OTO       | oto订单，为一组订单，只有第一个订单完全成交后触发第二笔订单  |                                                              |

**交易类型**

| transType | 名称         |
| --------- | ------------ |
| AK        | 订单保存     |
| AS        | 订单提交     |
| MK        | 订单修改保存 |
| MS        | 订单修改提交 |
| M         |              |
| A         | 激活         |
| AOK       | 保存OCO      |
| AOS       | 保存OTO      |



## 2. 新增订单（新增）

**流程**

1. 订单参数验证
   1. 类型验证：
      1. `订单类型`、`交易类型`不能为空，且必须是在`规定的`的类型
   2. 订单数据集合校验：
      1. 如果是追加`oto`订单 交易类型为：`AOS或者AOK`
         1. `orderType`必须是`OTO` 否则扔出异常。
      2. 如果是`FAK订单`
         1. 不支持保存、修改操作
      3. 交易员验证
      4. 循环遍历订单 
      5. 如果是 `AS、MS、AOS`这三种需要提价，直接推送到外汇市场的订单
         1. 验证是否是开市时间
      6. 如果是 `FAK订单`
         1. 验证滑点
      7. 验证是否倒挂 
      8. 订单类型为`MS和MA` 验证订单是否可以更改

2. 订单操作
   1. `SS和SLWP`订单类型 设置`flowPath`
   2. 循环订单，根据不同`transType`，组装基础订单表数据和deal订单表数据
   3. 如果是`AK、MK、AOK`设置状态，直接入库，如果是`AS、MS、AOS`设置状态，并写入待发送deal列表
3. 风控验证

## 3. 订单操作功能（冻结、撤销、激活）

订单操作针对已经创建的订单进行一系列操作。

修改、追加OTO、设置OCO操作弹出窗前，都会进行订单撤回操作，防止在修改期间，有成交量。

| 操作类型 | 操作内容 |
| -------- | -------- |
| 一键撤销 |          |
| 一键冻结 |          |
| 冻结     |          |
| 撤销     |          |
| 激活     |          |
| 设置OCO  |          |
| 追加OTO  |          |



**一键撤销**

点击一键撤销，如果订单为冻结直接改为撤销，如果订单为其他，则先发起撤销请求，将订单改为撤销中，er收到回复后再根据返回状态，更改为撤销或者撤销失败。已成交的会撤销失败。

**一键冻结**



**链路监控**



## 4. **OTO订单**

```graph LR
A -> B
B -> C

```

创建一个 A->B->C的`OTO订单`,其中A订单是B订单的前置，B订单是C订单的前置

如果A订单撤销，B和C订单也要撤销

如果B订单撤销，A订单不影响，C订单需要撤销

如果C订单撤销，A和B订单不影响

**前端操作：**

选中A订单，B和C订单需要自动选中，可执行`激活`、`撤销`操作

选中B订单，C订单需要自动选中，A订单不必选中，可执行 `撤销` 操作，不可执行`激活`操作

选中C订单，A和B订单都无需自动选中，可执行`撤销`操作，不可执行`激活`操作



如果A订单已经提交，选中B订单可以执行激活操作。按照链路依次类推

# 九、现存问题总结



